# Railway ìµœì í™” Dockerfile (Discord API ì§ì ‘ í˜¸ì¶œ ë²„ì „)
FROM python:3.11-slim

# ê¸°ë³¸ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    curl \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# Python ì˜ì¡´ì„± ì„¤ì¹˜ (ìºì‹± ìµœì í™”)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY ./app ./app
COPY ./discord_api_direct.py .
COPY ./config.env .

# Railway í¬íŠ¸ í™˜ê²½ë³€ìˆ˜ ì²˜ë¦¬ë¥¼ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
RUN echo '#!/bin/bash\n\
export PORT=${PORT:-8000}\n\
echo "ğŸš€ Starting Discord Collector API on port $PORT"\n\
echo "ğŸ“ Environment: Railway Deployment"\n\
cd /app\n\
exec python -m uvicorn app.discord_api_server:app --host 0.0.0.0 --port $PORT' > start.sh && \
chmod +x start.sh

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8000

# Railwayì—ì„œ ìë™ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” PORT í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©
CMD ["./start.sh"] 